# v1.0.1 Bug修复与优化

> 发布日期：2026-01-28
> 版本类型：Bug修复

---

## 版本概述

本次更新主要修复了MVP版本中发现的问题，包括管理员登录、数据库查询等Bug，并优化了登录跳转逻辑。

---

## 修复内容

### 1. 管理员密码修复

**问题描述**：
管理员账号 `admin@trip.com` 使用密码 `admin123` 无法登录，提示"邮箱或密码错误"。

**问题原因**：
`init-data.sql` 中预置的BCrypt密码哈希值与实际密码 `admin123` 不匹配。

**修复方案**：
- 重新生成 `admin123` 的正确BCrypt哈希值
- 更新数据库中admin用户的密码
- 更新 `init-data.sql` 中的密码哈希值

**涉及文件**：
- `database/init-data.sql`

---

### 2. POI查询参数错误修复

**问题描述**：
生成行程时报错 `Parameter index out of range (3 > number of parameters, which is 2)`。

**问题原因**：
`PoiServiceImpl.java` 中 `JSON_CONTAINS` 函数的参数绑定方式不正确。

**修复前**：
```java
wrapper.apply("JSON_CONTAINS(tags, '\"{0}\"')", tag);
```

**修复后**：
```java
wrapper.apply("JSON_CONTAINS(tags, {0})", "\"" + tag + "\"");
```

**涉及文件**：
- `backend/src/main/java/com/dali/trip/service/impl/PoiServiceImpl.java`

---

### 3. 数据库连接配置修复

**问题描述**：
后端启动后访问API报错 `Public Key Retrieval is not allowed`。

**问题原因**：
MySQL 8.0+ 使用 `caching_sha2_password` 认证插件，需要额外配置。

**修复方案**：
在数据库连接URL中添加 `allowPublicKeyRetrieval=true` 参数。

**涉及文件**：
- `backend/src/main/resources/application.yml`

---

### 4. 数据库密码配置修复

**问题描述**：
后端连接数据库失败，提示 `Access denied for user 'root'@'localhost'`。

**问题原因**：
配置文件中默认密码为 `root`，但本地MySQL使用空密码。

**修复方案**：
将默认密码改为空字符串。

**涉及文件**：
- `backend/src/main/resources/application.yml`

---

## 优化内容

### 1. 管理员登录跳转优化

**优化描述**：
管理员登录后自动跳转到后台管理页面，而非普通用户首页。

**修改逻辑**：
```javascript
if (userStore.user?.role === 'admin') {
  router.push('/admin')
} else {
  const redirect = route.query.redirect || '/'
  router.push(redirect)
}
```

**涉及文件**：
- `frontend/src/views/LoginPage.vue`

---

## 文档更新

### 1. 项目文档标题统一

将所有文档标题从"大理旅游线路规划平台"统一为"旅游线路规划平台设计与实现"。

**涉及文件**：
- `README.md`
- `docs/01-产品需求文档.md`
- `docs/02-技术架构文档.md`
- `docs/03-数据库设计文档.md`
- `docs/04-API接口文档.md`
- `docs/05-核心算法文档.md`
- `docs/06-部署运维文档.md`
- `docs/07-AI智能服务集成方案.md`
- `docs/08-未来规划与扩展设计.md`
- `docs/09-MVP开发任务清单.md`

### 2. 新增开发指南

创建开发者快速上手文档。

**涉及文件**：
- `docs/DEVELOPMENT.md`

### 3. 新增版本日志目录

创建 `docs/changelog/` 目录用于记录版本更新。

**涉及文件**：
- `docs/changelog/v1.0.0-MVP.md`
- `docs/changelog/v1.0.1.md` (本文档)

---

## 前端优化

### 1. 页面标题更新

- `index.html` 标题改为"旅游线路规划平台"
- `AppHeader.vue` Logo改为"旅游线路规划"

**涉及文件**：
- `frontend/index.html`
- `frontend/src/components/AppHeader.vue`

---

## 配置变更

### application.yml 变更

| 配置项 | 修改前 | 修改后 |
|--------|--------|--------|
| datasource.url | 无allowPublicKeyRetrieval | 添加allowPublicKeyRetrieval=true |
| datasource.password | ${DB_PASSWORD:root} | ${DB_PASSWORD:} |

---

## 测试验证

| 测试项 | 结果 |
|--------|------|
| 管理员登录 (admin@trip.com / admin123) | ✅ 通过 |
| 管理员登录后跳转到后台 | ✅ 通过 |
| 普通用户登录后跳转到首页 | ✅ 通过 |
| 生成行程功能 | ✅ 通过 |
| POI列表查询 | ✅ 通过 |
| 后台POI管理页面 | ✅ 通过 |

---

## 下一步计划

1. 地图功能完善
2. 首页设计
3. 社区功能完善
4. 行程编辑功能

---

**提交者**: 开发团队
**审核者**: -
